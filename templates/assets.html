{% extends 'layout.html' %}
{% block content %}
<section class="grid">
  <div class="card span-2">
    <h2>Your Assets</h2>
    <p style="margin:.4rem 0;">Total: <strong>{{ total_usd|money }}</strong></p>
    <div style="overflow-x:auto">
      <table class="table">
        <thead><tr><th>Date</th><th>Ticker / Name</th><th>Shares</th><th>Price</th><th>Value</th></tr></thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r['date'] }}</td>
            <td>{{ r['ticker'] }}</td>
            <td>{{ '%.4f'|format(r['shares']) }}</td>
            <td>{{ r['price']|money }}</td>
            <td>{{ (r['shares']*r['price'])|money }}</td>
          </tr>
          {% endfor %}
          {% if rows|length == 0 %}
          <tr><td colspan="5" style="opacity:.7">No assets yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card small-chart">
    <h3>Portfolio Breakdown</h3>
    <canvas id="assetPie"></canvas>
  </div>

  <div class="card">
    <h3>Add Asset</h3>
    <form method="post">
      <label>Date <input type="date" name="date" required></label>
      <label>Ticker/Name <input type="text" name="ticker" required></label>
      <label>Shares/Units <input type="number" step="0.0001" name="shares" required></label>
      <label>Price (per unit, in your currency) <input type="number" step="0.01" name="price" required></label>
      <button type="submit">Save Asset</button>
    </form>
    <p style="margin-top:.5rem;opacity:.8">* Prices are converted to USD internally using your Settings currency.</p>
  </div>
</section>

<script>
  const labels = {{ pie_labels|safe }};
  const vals   = {{ pie_values|safe }};
  if (vals.length){
    new Chart(document.getElementById('assetPie'), {
      type:'doughnut',
      data:{ labels, datasets:[{ data: vals }] }
    });
  }
</script>
{% endblock %}
